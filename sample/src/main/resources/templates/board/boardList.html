<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<meta charset="UTF-8">
	<title>board</title>
	<link rel="stylesheet" th:href="@{/css/board.css}"/>
</head>
<div th:replace="/fragments/header.html :: fragment-header"></div>
<body onLoad="javascript:pop()">
<div th:replace="/fragments/nav.html :: fragment-nav"></div>
<div class="container">
    <!-- 에러 메시지가 있을 경우 모달을 띄운다 -->
    <div th:if="${errorMessage != null}" class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="errorModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="errorModalLabel">알림</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p th:text="${errorMessage}"></p> <!-- 에러 메시지 표시 -->
                </div>
                <div class="modal-footer">
                    <a href="/login" class="btn btn-secondary">닫기</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            if ('${errorMessage}' != '') {
                $('#errorModal').modal('show');
            }
        });
    </script>

    	<h2>게시글 목록</h2>
    	<table class="board_list">
	        <colgroup>
	            <col width="15%"/>
	            <col width="*"/>
	            <col width="15%"/>
	            <col width="20%"/>
	        </colgroup>
	        <thead>
	            <tr>
	                <th scope="col">글번호</th>
	                <th scope="col">제목</th>
	                <th scope="col">조회수</th>
	                <th scope="col">작성일</th>
					<th scope="col">댓글수</th>
	            </tr>
	        </thead>
	        <tbody>
	        	<tr th:if="${#lists.size(list)} > 0" th:each="list : ${list}">
	        		<td th:text="${list.boardIdx}"></td>
	        		<td class="title"><a href="/board/boardDetail?boardIdx=" th:attrappend="href=${list.boardIdx}" th:text="${list.title}"></a></td>
	        		<td th:text="${list.hitCnt}"></td>
	        		<td th:text="${list.createdDatetime}"></td>
					<td th:text="${list.replyCnt}"></td>
	        	</tr>
	        	<tr th:unless="${#lists.size(list)} > 0">
	        		<td colspan="4">조회된 결과가 없습니다.</td>
	        	</tr>
	        </tbody>
	    </table>
	<div class="d-flex justify-content-between align-items-center mb-3">
		<!-- 글쓰기 버튼 -->
		<a href="/board/boardWrite" class="btn btn-outline-primary">글 쓰기</a>
		<!-- 검색 창 -->
		<form action="/board/search" method="get" class="form-inline">
			<input type="text" name="query" class="form-control mr-sm-2" placeholder="검색어를 입력하세요" aria-label="Search" style="margin-top: 23px;"/>
			<button type="submit" class="btn btn-outline-success">검색</button>
		</form>
	</div>

		<!-- 페이징 -->
		<div th:if="${!list.isEmpty()}">
			<!-- 전역 변수 선언 -->
			<nav
					th:with="pageNumber = ${list.pageable.pageNumber}, pageSize = ${list.pageable.pageSize},totalPages = ${list.totalPages},startPage = ${T(java.lang.Math).floor(pageNumber / pageSize) * pageSize + 1},tempEndPage = ${startPage + pageSize - 1},endPage = (${tempEndPage < totalPages ? tempEndPage : totalPages})"
					aria-label="Page navigation"
			>
				<ul class="pagination">
					<!-- 처음으로 이동 -->
                    <li th:classappend="${pageNumber == 0} ? 'disabled'" class="page-item">
                        <a class="page-link" th:href="@{/board/boardList(page=0)}">
                            <span>&laquo;</span>
                            <span class="sr-only">First</span>
                        </a>
                    </li>


					<!-- 이전으로 이동 -->
					<li th:classappend="${list.first} ? 'disabled'" class="page-item">
						<a class="page-link" th:href="${list.first} ? '#' : @{/board/boardList(page=${pageNumber - 1})}" aria-label="Previous">
							<span aria-hidden="true">&lt;</span>
							<span class="sr-only">Previous</span>
						</a>
					</li>


					<!-- 특정 페이지로 이동 -->
					<li th:each="page: ${#numbers.sequence(startPage, endPage)}" th:classappend="${page == pageNumber + 1} ? 'active'" class="page-item">
						<a th:text="${page}" class="page-link" th:href="@{/board/boardList(page=${page - 1})}"></a>
					</li>


					<!-- 다음으로 이동 -->
					<li th:classappend="${list.last} ? 'disabled'" class="page-item">
						<a class="page-link" th:href="${list.last} ? '#' : @{/board/boardList(page=${pageNumber + 1})}" aria-label="Next">
							<span aria-hidden="true">&gt;</span>
							<span class="sr-only">Next</span>
						</a>
					</li>


					<!-- 마지막으로 이동 -->
                    <li th:classappend="${pageNumber == totalPages - 1} ? 'disabled'" class="page-item">
                        <a class="page-link" th:href="@{/board/boardList(page=${totalPages - 1})}">
                            <span>&raquo;</span>
                            <span class="sr-only">Last</span>
                        </a>
                    </li>
				</ul>
			</nav>
		</div> <!-- /container -->

	</div>
<div th:replace="/fragments/footer.html :: fragment-footer"></div>
</body>
</html>